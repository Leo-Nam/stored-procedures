CREATE DEFINER=`chiumdb`@`%` PROCEDURE `sp_get_bidding_info`(
	IN IN_BIDDING_ID					BIGINT,
    OUT OUT_BIDDING_INFO				JSON
)
BEGIN   
    
	CREATE TEMPORARY TABLE IF NOT EXISTS TRANSACTION_INFO_TEMP (
		ID								BIGINT,
		COLLECTOR_ID					BIGINT,
		DISPOSAL_ORDER_ID				BIGINT,
		BID_AMOUNT						INT,
		TRMT_METHOD						VARCHAR(4),
		GREENHOUSE_GAS					FLOAT,
		WINNER							TINYINT,
		ACTIVE							TINYINT,
        BIDDING_RANK					INT,
        STATUS_CODE						INT,
        CREATED_AT						DATETIME,
        DELETED							TINYINT,
        DELETED_AT						DATETIME,
        DATE_OF_VISIT					DATETIME,
        RESPONSE_VISIT					TINYINT,
        RESPONSE_VISIT_AT				DATETIME,
        CANCEL_VISIT					TINYINT,
        CANCEL_VISIT_AT					DATETIME,
        REJECT_BIDDING_APPLY			TINYINT,
        REJECT_BIDDING_APPLY_AT			DATETIME,
        GIVEUP_BIDDING					TINYINT,
        GIVEUP_BIDDING_AT				DATETIME,
        DATE_OF_BIDDING					DATETIME,
        CANCEL_BIDDING					TINYINT,
        CANCEL_BIDDING_AT				DATETIME,
        REJECT_BIDDING					TINYINT,
        REJECT_BIDDING_AT				DATETIME,
        SELECTED						TINYINT,
        SELECTED_AT						DATETIME,
        MAKE_DECISION					TINYINT,
        MAKE_DECISION_AT				DATETIME,
        MAX_DECISION_AT					DATETIME,
        ORDER_VISIBLE					TINYINT,
        ORDER_VISIBLE_CHANGED_AT		DATETIME,
        BIDDING_VISIBLE					TINYINT,
        BIDDING_VISIBLE_CHANGED_AT		DATETIME,
        UPDATED_AT						DATETIME,
        TRANSACTION_ID					BIGINT,
        STATIC_STATE					INT
	);     
    
    
	INSERT INTO 
	TRANSACTION_INFO_TEMP(
		ID,
		COLLECTOR_ID,
		DISPOSAL_ORDER_ID,
		BID_AMOUNT,
		TRMT_METHOD,
		GREENHOUSE_GAS,
		WINNER,
		ACTIVE,
        BIDDING_RANK,
        STATUS_CODE,
        CREATED_AT,
        DELETED,
        DELETED_AT,
        DATE_OF_VISIT,
        RESPONSE_VISIT,
        RESPONSE_VISIT_AT,
        CANCEL_VISIT,
        CANCEL_VISIT_AT,
        REJECT_BIDDING_APPLY,
        REJECT_BIDDING_APPLY_AT,
        GIVEUP_BIDDING,
        GIVEUP_BIDDING_AT,
        DATE_OF_BIDDING,
        CANCEL_BIDDING,
        CANCEL_BIDDING_AT,
        REJECT_BIDDING,
        REJECT_BIDDING_AT,
        SELECTED,
        SELECTED_AT,
        MAKE_DECISION,
        MAKE_DECISION_AT,
        MAX_DECISION_AT,
        ORDER_VISIBLE,
        ORDER_VISIBLE_CHANGED_AT,
        BIDDING_VISIBLE,
        BIDDING_VISIBLE_CHANGED_AT,
        UPDATED_AT,
        TRANSACTION_ID,
        STATIC_STATE
	)
	SELECT 
		ID,
		COLLECTOR_ID,
		DISPOSAL_ORDER_ID,
		BID_AMOUNT,
		TRMT_METHOD,
		GREENHOUSE_GAS,
		WINNER,
		ACTIVE,
        BIDDING_RANK,
        STATUS_CODE,
        CREATED_AT,
        DELETED,
        DELETED_AT,
        DATE_OF_VISIT,
        RESPONSE_VISIT,
        RESPONSE_VISIT_AT,
        CANCEL_VISIT,
        CANCEL_VISIT_AT,
        REJECT_BIDDING_APPLY,
        REJECT_BIDDING_APPLY_AT,
        GIVEUP_BIDDING,
        GIVEUP_BIDDING_AT,
        DATE_OF_BIDDING,
        CANCEL_BIDDING,
        CANCEL_BIDDING_AT,
        REJECT_BIDDING,
        REJECT_BIDDING_AT,
        SELECTED,
        SELECTED_AT,
        MAKE_DECISION,
        MAKE_DECISION_AT,
        MAX_DECISION_AT,
        ORDER_VISIBLE,
        ORDER_VISIBLE_CHANGED_AT,
        BIDDING_VISIBLE,
        BIDDING_VISIBLE_CHANGED_AT,
        UPDATED_AT,
        TRANSACTION_ID,
        STATIC_STATE
	FROM COLLECTOR_BIDDING
    WHERE ID = IN_BIDDING_ID; 
    
	SELECT JSON_ARRAYAGG(JSON_OBJECT(
		'ID'							, ID, 
		'COLLECTOR_ID'					, COLLECTOR_ID, 
		'DISPOSAL_ORDER_ID'				, DISPOSAL_ORDER_ID, 
		'BID_AMOUNT'					, BID_AMOUNT, 
		'TRMT_METHOD'					, TRMT_METHOD, 
		'GREENHOUSE_GAS'				, GREENHOUSE_GAS, 
		'WINNER'						, WINNER, 
		'ACTIVE'						, ACTIVE, 
		'BIDDING_RANK'					, BIDDING_RANK, 
		'STATUS_CODE'					, STATUS_CODE, 
		'CREATED_AT'					, CREATED_AT, 
		'DELETED'						, DELETED, 
		'DELETED_AT'					, DELETED_AT, 
		'DATE_OF_VISIT'					, DATE_OF_VISIT, 
		'RESPONSE_VISIT'				, RESPONSE_VISIT, 
		'RESPONSE_VISIT_AT'				, RESPONSE_VISIT_AT, 
		'CANCEL_VISIT'					, CANCEL_VISIT, 
        'CANCEL_VISIT_AT'				, CANCEL_VISIT_AT,
        'REJECT_BIDDING_APPLY'			, REJECT_BIDDING_APPLY,
		'REJECT_BIDDING_APPLY_AT'		, REJECT_BIDDING_APPLY_AT, 
		'GIVEUP_BIDDING'				, GIVEUP_BIDDING, 
		'GIVEUP_BIDDING_AT'				, GIVEUP_BIDDING_AT, 
		'DATE_OF_BIDDING'				, DATE_OF_BIDDING, 
		'CANCEL_BIDDING'				, CANCEL_BIDDING, 
		'CANCEL_BIDDING_AT'				, CANCEL_BIDDING_AT, 
		'REJECT_BIDDING'				, REJECT_BIDDING, 
		'REJECT_BIDDING_AT'				, REJECT_BIDDING_AT, 
		'SELECTED'						, SELECTED, 
		'SELECTED_AT'					, SELECTED_AT, 
		'MAKE_DECISION'					, MAKE_DECISION, 
		'MAKE_DECISION_AT'				, MAKE_DECISION_AT, 
		'MAX_DECISION_AT'				, MAX_DECISION_AT, 
		'ORDER_VISIBLE'					, ORDER_VISIBLE, 
		'ORDER_VISIBLE_CHANGED_AT'		, ORDER_VISIBLE_CHANGED_AT, 
		'BIDDING_VISIBLE'				, BIDDING_VISIBLE, 
		'BIDDING_VISIBLE_CHANGED_AT'	, BIDDING_VISIBLE_CHANGED_AT, 
		'UPDATED_AT'					, UPDATED_AT, 
		'TRANSACTION_ID'				, TRANSACTION_ID, 
		'STATIC_STATE'					, STATIC_STATE
	)) 
	INTO OUT_BIDDING_INFO
	FROM TRANSACTION_INFO_TEMP
    WHERE ID = IN_BIDDING_ID;     
	DROP TABLE IF EXISTS TRANSACTION_INFO_TEMP;

END